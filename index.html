<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Merge JPGs into searchable multilingual PDFs with offline OCR (Korean, English, Japanese, Russian). No account. No API. Just privacy & speed."
    />
    <meta
      name="keywords"
      content="JPG to PDF, OCR PDF, Korean OCR, Japanese OCR, Russian OCR, multilingual PDF converter, offline image to searchable PDF"
    />
    <meta name="author" content="pic2searchpdf" />
    <title>pic2searchpdf - JPG to OCR PDF (KR/EN/JP/RU)</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <style>
      body {
        font-family: sans-serif;
        background: #f8f9fa;
        color: #333;
        margin: 0;
        padding: 2rem;
        max-width: 800px;
        margin: auto;
      }
      header {
        text-align: center;
        margin-bottom: 2rem;
      }
      h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      input[type="file"] {
        display: block;
        margin: 1rem 0;
      }
      button {
        background: #0066cc;
        color: #fff;
        padding: 0.6rem 1rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #output {
        margin-top: 2rem;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>pic2searchpdf</h1>
      <p>JPG을 PDF로 병합하고 OCR 텍스트 검색 가능하게 (한/영/일/러)</p>
      <p><small>무료 · 로컬실행 · 개인정보 수집 없음</small></p>
    </header>

    <input type="file" id="imageFiles" multiple accept="image/jpeg" />
    <button onclick="processImages()">PDF 만들기 + OCR입히기</button>

    <div id="output"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

    <script>
      const langs = ["kor", "eng", "jpn", "rus"];
      const STORAGE_KEY = "pic2searchpdf-session";

      async function processImages() {
        const files = document.getElementById("imageFiles").files;
        if (!files.length) return alert("이미지를 업로드해주세요.");

        const { PDFDocument, rgb } = PDFLib;
        const pdfDoc = await PDFDocument.create();
        const ocrResults = [];

        for (let file of files) {
          const reader = new FileReader();
          const imageData = await new Promise((res) => {
            reader.onload = () => res(reader.result);
            reader.readAsDataURL(file);
          });

          const imgBytes = await fetch(imageData).then((res) =>
            res.arrayBuffer()
          );
          const img = await pdfDoc.embedJpg(imgBytes);
          const page = pdfDoc.addPage([img.width, img.height]);
          page.drawImage(img, {
            x: 0,
            y: 0,
            width: img.width,
            height: img.height,
          });

          const text = await Tesseract.recognize(imgBytes, langs.join("+"), {
            logger: (m) => console.log(m),
          });
          ocrResults.push(text.data.text);
        }

        const metadataText = ocrResults.join("\n\n");
        const textPage = pdfDoc.addPage([612, 792]);
        textPage.drawText(metadataText.slice(0, 4000), {
          x: 50,
          y: 750,
          size: 10,
          maxWidth: 500,
          color: rgb(0, 0, 0),
        });

        const pdfBytes = await pdfDoc.save();
        localStorage.setItem(
          STORAGE_KEY,
          JSON.stringify([...files].map((f) => f.name))
        );

        const blob = new Blob([pdfBytes], { type: "application/pdf" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "merged_ocr.pdf";
        link.click();

        document.getElementById("output").innerText = "✅ PDF 생성 완료";
      }
    </script>
  </body>
</html>
