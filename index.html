<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      JPGë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë³€í™˜ - OCR ë¬´ë£Œ, ë¹ ë¥´ê³  ê°„í¸í•˜ê²Œ |
      PicToSearchablePDF.app
    </title>
    <meta
      name="description"
      content="JPG ì´ë¯¸ì§€ë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë¬´ë£Œë¡œ ë³€í™˜í•˜ê³  OCR ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì„¸ìš”. ì‚¬ì§„, ìŠ¤ìº” íŒŒì¼ì„ ì†ì‰½ê²Œ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë§Œë“œì„¸ìš”. ë¹ ë¥´ê³  ê°„ë‹¨í•œ ì˜¨ë¼ì¸ ë„êµ¬."
    />
    <meta
      name="keywords"
      content="JPG to PDF, OCR PDF, ì´ë¯¸ì§€ PDF ë³€í™˜, ê²€ìƒ‰ ê°€ëŠ¥í•œ PDF, ë¬´ë£Œ OCR, ì˜¨ë¼ì¸ PDF ë³€í™˜, ì‚¬ì§„ PDF, ìŠ¤ìº” PDF, í…ìŠ¤íŠ¸ ì¶”ì¶œ, pic2searchpdf"
    />
    <meta
      property="og:title"
      content="JPGë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë³€í™˜ - OCR ë¬´ë£Œ, ë¹ ë¥´ê³  ê°„í¸í•˜ê²Œ | PicToSearchablePDF.app"
    />
    <meta
      property="og:description"
      content="JPG ì´ë¯¸ì§€ë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë¬´ë£Œë¡œ ë³€í™˜í•˜ê³  OCR ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì„¸ìš”. ì‚¬ì§„, ìŠ¤ìº” íŒŒì¼ì„ ì†ì‰½ê²Œ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë§Œë“œì„¸ìš”. ë¹ ë¥´ê³  ê°„ë‹¨í•œ ì˜¨ë¼ì¸ ë„êµ¬."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://pic2searchpdf.netlify.app/" />
    <meta
      property="og:image"
      content="https://placehold.co/1200x630/007bff/ffffff?text=PicToSearchablePDF"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="JPGë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë³€í™˜ - OCR ë¬´ë£Œ, ë¹ ë¥´ê³  ê°„í¸í•˜ê²Œ | PicToSearchablePDF.app"
    />
    <meta
      name="twitter:description"
      content="JPG ì´ë¯¸ì§€ë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë¬´ë£Œë¡œ ë³€í™˜í•˜ê³  OCR ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì„¸ìš”. ì‚¬ì§„, ìŠ¤ìº” íŒŒì¼ì„ ì†ì‰½ê²Œ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë§Œë“œì„¸ìš”. ë¹ ë¥´ê³  ê°„ë‹¨í•œ ì˜¨ë¼ì¸ ë„êµ¬."
    />
    <meta
      name="twitter:image"
      content="https://placehold.co/1200x675/007bff/ffffff?text=PicToSearchablePDF"
    />

    <!-- Favicon -->
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90' fill='%23007bff'%3EğŸ“„%3C/text%3E%3Ctext y='0.9em' font-size='40' x='50' y='50' fill='%23fff' text-anchor='middle'%3EP2S%3C/text%3E%3C/svg%3E"
      type="image/svg+xml"
    />
    <!-- Inline CSS for a simple, beautiful, and responsive design -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap");

      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f7f6; /* Soft background color */
        color: #333;
        line-height: 1.6;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .container {
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 12px; /* More rounded corners */
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); /* Softer shadow */
        flex-grow: 1;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }

      header h1 {
        color: #007bff; /* Primary blue for headings */
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      header p {
        font-size: 1.1em;
        color: #666;
      }

      .ad-container {
        width: 100%;
        height: 90px; /* Standard banner size */
        background-color: #e0e0e0;
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #666;
        border-radius: 8px;
        font-size: 0.9em;
        border: 1px dashed #bbb;
      }

      .drop-area {
        border: 3px dashed #007bff; /* Primary blue border */
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: background-color 0.3s ease, border-color 0.3s ease;
        margin-bottom: 20px;
        background-color: #f7fcff; /* Light blue background for drop area */
      }

      .drop-area.highlight {
        background-color: #e3f2fd; /* Lighter blue on drag over */
        border-color: #0056b3;
      }

      .drop-area p {
        margin: 0;
        font-size: 1.2em;
        color: #007bff;
        font-weight: 600;
      }

      .drop-area input[type="file"] {
        display: none;
      }

      .button-group {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping on small screens */
        gap: 15px; /* Spacing between buttons */
        margin-top: 20px;
        justify-content: center;
        align-items: center;
      }

      .button-group button {
        background-color: #28a745; /* Success green for main action */
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2);
        font-weight: 600;
      }

      .button-group button:hover {
        background-color: #218838;
        transform: translateY(-2px);
      }

      .button-group button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }

      .language-select {
        padding: 10px 15px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1em;
        color: #555;
        background-color: #f9f9f9;
      }

      #fileList {
        margin-top: 30px;
        border-top: 1px solid #eee;
        padding-top: 20px;
      }

      .file-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease;
        position: relative; /* For reordering handles */
      }

      .file-item.dragging {
        opacity: 0.7;
        transform: scale(1.02);
      }

      .file-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        margin-right: 20px;
        border: 1px solid #ddd;
      }

      .file-info {
        flex-grow: 1;
      }

      .file-info p {
        margin: 0;
        font-size: 1.1em;
        font-weight: 600;
        color: #333;
      }

      .file-item .actions {
        display: flex;
        gap: 10px;
        margin-left: 20px;
      }

      .file-item .actions button {
        background-color: #dc3545; /* Danger red for remove */
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color 0.3s ease;
      }

      .file-item .actions button:hover {
        background-color: #c82333;
      }

      .file-item .move-buttons button {
        background-color: #007bff; /* Primary blue for move buttons */
        padding: 8px 10px;
        font-size: 0.9em;
      }
      .file-item .move-buttons button:hover {
        background-color: #0056b3;
      }

      .progress-container {
        margin-top: 20px;
        width: 100%;
        background-color: #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        height: 25px;
      }

      .progress-bar {
        height: 100%;
        width: 0%;
        background-color: #17a2b8; /* Info blue for progress */
        border-radius: 8px;
        text-align: center;
        color: white;
        line-height: 25px;
        font-size: 0.9em;
        transition: width 0.4s ease-in-out;
      }

      #statusMessage {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        background-color: #ffe0b2; /* Light orange for status */
        color: #e65100;
        border: 1px solid #ffcc80;
        text-align: center;
        font-weight: 600;
        display: none; /* Hidden by default */
      }

      .ocr-preview-container {
        margin-top: 20px;
        padding: 15px;
        background-color: #e6f7ff; /* Lighter blue for OCR preview */
        border: 1px solid #91d5ff;
        border-radius: 10px;
        max-height: 200px;
        overflow-y: auto;
        white-space: pre-wrap; /* Preserve whitespace and line breaks */
        font-size: 0.9em;
        color: #333;
        line-height: 1.4;
      }

      .ocr-text-toggle {
        background-color: #6c757d; /* Grey for toggle button */
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.8em;
        margin-top: 5px;
        transition: background-color 0.3s ease;
      }
      .ocr-text-toggle:hover {
        background-color: #5a6268;
      }

      footer {
        text-align: center;
        padding: 20px;
        margin-top: 40px;
        border-top: 1px solid #eee;
        color: #777;
        font-size: 0.9em;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .container {
          margin: 10px;
          padding: 15px;
        }

        header h1 {
          font-size: 1.8em;
        }

        .drop-area {
          padding: 30px;
        }

        .button-group {
          flex-direction: column;
          gap: 10px;
        }
        .button-group button {
          width: 100%;
        }

        .file-item {
          flex-direction: column;
          align-items: flex-start;
        }
        .file-item img {
          margin-bottom: 10px;
          margin-right: 0;
        }
        .file-item .actions {
          width: 100%;
          justify-content: flex-end; /* Align actions to the right */
          margin-top: 10px;
        }
        .file-item .move-buttons {
          width: 100%;
          display: flex;
          justify-content: flex-start;
          margin-top: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>
          ğŸ“„ JPGë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ
          <span style="color: #28a745">ê°„í¸í•˜ê²Œ</span> ë³€í™˜!
        </h1>
        <p>
          ì‚¬ì§„ì´ë‚˜ ìŠ¤ìº”í•œ JPG ì´ë¯¸ì§€ì— OCRì„ ì…í˜€ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ
          ë§Œë“¤ì–´ ë³´ì„¸ìš”. ë³µì¡í•œ ê³¼ì • ì—†ì´ ëˆ„êµ¬ë‚˜ ì‰½ê³  ë¹ ë¥´ê²Œ!
        </p>
      </header>

      <!-- AdSense Slot (Placeholder) -->
      <div class="ad-container">ê´‘ê³  ê³µê°„ (êµ¬ê¸€ ì• ë“œì„¼ìŠ¤)</div>

      <div class="drop-area" id="dropArea">
        <p>ì—¬ê¸°ì— JPG íŒŒì¼ì„ ëŒì–´ë‹¤ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”.</p>
        <input
          type="file"
          id="fileInput"
          accept="image/jpeg,image/png"
          multiple
        />
      </div>

      <div class="button-group">
        <label for="languageSelect" style="font-weight: 600; color: #555"
          >OCR ì–¸ì–´:</label
        >
        <select id="languageSelect" class="language-select">
          <option value="kor">í•œêµ­ì–´</option>
          <option value="eng">ì˜ì–´</option>
          <option value="jpn">ì¼ë³¸ì–´</option>
          <option value="rus">ëŸ¬ì‹œì•„ì–´</option>
          <option value="chi_sim">ì¤‘êµ­ì–´ (ê°„ì²´)</option>
        </select>
        <button id="convertButton" disabled>PDFë¡œ ë³€í™˜ ë° OCR ì ìš©</button>
        <button id="clearButton" disabled>ì´ˆê¸°í™”</button>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div id="statusMessage"></div>

      <div id="fileList">
        <!-- Uploaded files will be listed here -->
      </div>
    </div>

    <footer>
      <p>&copy; 2025 PicToSearchablePDF.app. All rights reserved.</p>
      <p>ê°„í¸í•˜ê²Œ, ë¹ ë¥´ê²Œ, ë¬´ë£Œë¡œ JPGë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ PDFë¡œ ë³€í™˜í•˜ì„¸ìš”!</p>
    </footer>

    <!-- jspdf and tesseract.js libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@5.0.3/dist/tesseract.min.js"></script>

    <script>
      // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
      const dropArea = document.getElementById("dropArea");
      const fileInput = document.getElementById("fileInput");
      const fileList = document.getElementById("fileList");
      const convertButton = document.getElementById("convertButton");
      const clearButton = document.getElementById("clearButton");
      const progressBar = document.getElementById("progressBar");
      const statusMessage = document.getElementById("statusMessage");
      const languageSelect = document.getElementById("languageSelect");

      // íŒŒì¼ ë°°ì—´: File ê°ì²´ì™€ OCR í…ìŠ¤íŠ¸, ê³ ìœ  IDë¥¼ ì €ì¥
      let filesToProcess = [];
      let tesseractWorker = null; // Tesseract.js ì›Œì»¤ ì¸ìŠ¤í„´ìŠ¤

      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤
      const LOCAL_STORAGE_KEY = "pic2searchpdf_session";

      /**
       * ìƒíƒœ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê±°ë‚˜ ìˆ¨ê¹ë‹ˆë‹¤.
       * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€.
       * @param {string} type - 'success', 'error', 'info', 'warning' (ìŠ¤íƒ€ì¼ ë³€ê²½ìš©).
       */
      function showStatusMessage(message, type = "info") {
        statusMessage.textContent = message;
        statusMessage.style.display = "block";
        statusMessage.style.backgroundColor = ""; // Reset
        statusMessage.style.color = ""; // Reset
        statusMessage.style.borderColor = ""; // Reset

        switch (type) {
          case "success":
            statusMessage.style.backgroundColor = "#d4edda";
            statusMessage.style.color = "#155724";
            statusMessage.style.borderColor = "#c3e6cb";
            break;
          case "error":
            statusMessage.style.backgroundColor = "#f8d7da";
            statusMessage.style.color = "#721c24";
            statusMessage.style.borderColor = "#f5c6cb";
            break;
          case "warning":
            statusMessage.style.backgroundColor = "#ffe0b2";
            statusMessage.style.color = "#e65100";
            statusMessage.style.borderColor = "#ffcc80";
            break;
          case "info":
          default:
            statusMessage.style.backgroundColor = "#e6f7ff";
            statusMessage.style.color = "#1890ff";
            statusMessage.style.borderColor = "#91d5ff";
            break;
        }
      }

      /**
       * ìƒíƒœ ë©”ì‹œì§€ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
       */
      function hideStatusMessage() {
        statusMessage.style.display = "none";
      }

      /**
       * íŒŒì¼ ëª©ë¡ UIë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
       */
      function renderFileList() {
        fileList.innerHTML = "";
        if (filesToProcess.length === 0) {
          showStatusMessage(
            "JPG íŒŒì¼ì„ ëŒì–´ë‹¤ ë†“ê±°ë‚˜ ì„ íƒí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”.",
            "info"
          );
          convertButton.disabled = true;
          clearButton.disabled = true;
          return;
        }

        hideStatusMessage();
        convertButton.disabled = false;
        clearButton.disabled = false;

        filesToProcess.forEach((fileObj, index) => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "file-item";
          itemDiv.draggable = true; // Make draggable for reordering
          itemDiv.dataset.id = fileObj.id; // Store unique ID for reordering

          const img = document.createElement("img");
          img.src = fileObj.previewUrl;
          img.alt = fileObj.file.name;

          const infoDiv = document.createElement("div");
          infoDiv.className = "file-info";
          const pName = document.createElement("p");
          pName.textContent = `${fileObj.file.name} (${(
            fileObj.file.size /
            1024 /
            1024
          ).toFixed(2)} MB)`;
          infoDiv.appendChild(pName);

          // OCR í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°
          const ocrPreviewDiv = document.createElement("div");
          ocrPreviewDiv.className = "ocr-preview-container";
          ocrPreviewDiv.style.display = "none"; // Hidden by default
          ocrPreviewDiv.textContent =
            fileObj.ocrText || "OCR í…ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...";

          const toggleOcrButton = document.createElement("button");
          toggleOcrButton.className = "ocr-text-toggle";
          toggleOcrButton.textContent = "OCR í…ìŠ¤íŠ¸ ë³´ê¸°";
          toggleOcrButton.onclick = () => {
            ocrPreviewDiv.style.display =
              ocrPreviewDiv.style.display === "none" ? "block" : "none";
            toggleOcrButton.textContent =
              ocrPreviewDiv.style.display === "none"
                ? "OCR í…ìŠ¤íŠ¸ ë³´ê¸°"
                : "OCR í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°";
          };

          if (fileObj.ocrText) {
            infoDiv.appendChild(toggleOcrButton);
            infoDiv.appendChild(ocrPreviewDiv);
          }

          const actionsDiv = document.createElement("div");
          actionsDiv.className = "actions";

          const moveButtonsDiv = document.createElement("div");
          moveButtonsDiv.className = "move-buttons";

          const moveUpButton = document.createElement("button");
          moveUpButton.textContent = "â–² ìœ„ë¡œ";
          moveUpButton.onclick = () => moveFile(index, -1);
          moveUpButton.disabled = index === 0;

          const moveDownButton = document.createElement("button");
          moveDownButton.textContent = "â–¼ ì•„ë˜ë¡œ";
          moveDownButton.onclick = () => moveFile(index, 1);
          moveDownButton.disabled = index === filesToProcess.length - 1;

          moveButtonsDiv.appendChild(moveUpButton);
          moveButtonsDiv.appendChild(moveDownButton);

          const removeButton = document.createElement("button");
          removeButton.textContent = "ì‚­ì œ";
          removeButton.onclick = () => removeFile(fileObj.id);

          actionsDiv.appendChild(moveButtonsDiv);
          actionsDiv.appendChild(removeButton);

          itemDiv.appendChild(img);
          itemDiv.appendChild(infoDiv);
          itemDiv.appendChild(actionsDiv);
          fileList.appendChild(itemDiv);
        });

        saveSession(); // UI ë Œë”ë§ í›„ ì„¸ì…˜ ì €ì¥
      }

      /**
       * íŒŒì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
       * @param {File[]} files - ì¶”ê°€í•  File ê°ì²´ ë°°ì—´.
       */
      async function addFiles(files) {
        for (const file of files) {
          if (
            file.type.startsWith("image/jpeg") ||
            file.type.startsWith("image/png")
          ) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const uniqueId = crypto.randomUUID(); // ê³ ìœ  ID ìƒì„±
              filesToProcess.push({
                id: uniqueId,
                file: file,
                previewUrl: e.target.result,
                ocrText: null, // ì´ˆê¸° OCR í…ìŠ¤íŠ¸ëŠ” null
                isProcessed: false, // OCR ì²˜ë¦¬ ì—¬ë¶€
              });
              renderFileList(); // íŒŒì¼ ì¶”ê°€ í›„ UI ì—…ë°ì´íŠ¸
            };
            reader.readAsDataURL(file);
          } else {
            showStatusMessage(
              `'${file.name}' íŒŒì¼ì€ JPG ë˜ëŠ” PNG ì´ë¯¸ì§€ê°€ ì•„ë‹™ë‹ˆë‹¤.`,
              "warning"
            );
          }
        }
      }

      /**
       * íŒŒì¼ì„ ëª©ë¡ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.
       * @param {string} id - ì œê±°í•  íŒŒì¼ì˜ ê³ ìœ  ID.
       */
      function removeFile(id) {
        filesToProcess = filesToProcess.filter((fileObj) => fileObj.id !== id);
        renderFileList();
      }

      /**
       * íŒŒì¼ ìˆœì„œë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.
       * @param {number} currentIndex - í˜„ì¬ íŒŒì¼ ì¸ë±ìŠ¤.
       * @param {number} direction - ì´ë™ ë°©í–¥ (1 for down, -1 for up).
       */
      function moveFile(currentIndex, direction) {
        const newIndex = currentIndex + direction;
        if (newIndex >= 0 && newIndex < filesToProcess.length) {
          const [movedItem] = filesToProcess.splice(currentIndex, 1);
          filesToProcess.splice(newIndex, 0, movedItem);
          renderFileList();
        }
      }

      /**
       * ëª¨ë“  íŒŒì¼ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
       */
      function clearAllFiles() {
        filesToProcess = [];
        progressBar.style.width = "0%";
        progressBar.textContent = "";
        renderFileList();
        localStorage.removeItem(LOCAL_STORAGE_KEY); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œë„ ì‚­ì œ
        showStatusMessage(
          "ëª¨ë“  íŒŒì¼ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.",
          "info"
        );
      }

      /**
       * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— í˜„ì¬ ì„¸ì…˜ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
       * ì‹¤ì œ íŒŒì¼ ë°ì´í„°ëŠ” ì €ì¥í•˜ì§€ ì•Šê³ , íŒŒì¼ ë©”íƒ€ë°ì´í„°ì™€ OCR í…ìŠ¤íŠ¸ë§Œ ì €ì¥í•©ë‹ˆë‹¤.
       */
      function saveSession() {
        const sessionData = filesToProcess.map((fileObj) => ({
          id: fileObj.id,
          fileName: fileObj.file.name,
          fileSize: fileObj.file.size,
          fileType: fileObj.file.type,
          lastModified: fileObj.file.lastModified,
          ocrText: fileObj.ocrText, // OCR ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ ì €ì¥
        }));
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(sessionData));
      }

      /**
       * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„¸ì…˜ ì •ë³´ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
       * ì‚¬ìš©ìì—ê²Œ íŒŒì¼ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•˜ë„ë¡ ìš”ì²­í•˜ê³ , ì €ì¥ëœ OCR í…ìŠ¤íŠ¸ë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.
       */
      async function loadSession() {
        const storedSession = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (storedSession) {
          try {
            const sessionData = JSON.parse(storedSession);
            if (sessionData.length > 0) {
              showStatusMessage(
                "ì´ì „ ì„¸ì…˜ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. íŒŒì¼ë“¤ì„ ë‹¤ì‹œ ì„ íƒí•˜ì‹œë©´ OCR í…ìŠ¤íŠ¸ê°€ ë³µêµ¬ë©ë‹ˆë‹¤.",
                "info"
              );
              // ì´ì „ ì„¸ì…˜ì˜ íŒŒì¼ ëª©ë¡ì„ ì¬êµ¬ì„± (íŒŒì¼ ê°ì²´ ì—†ì´ ë©”íƒ€ë°ì´í„°ë§Œ)
              filesToProcess = sessionData.map((data) => ({
                id: data.id,
                file: new File([], data.fileName, {
                  type: data.fileType,
                  lastModified: data.lastModified,
                }), // ë”ë¯¸ File ê°ì²´
                previewUrl: null, // ë¯¸ë¦¬ë³´ê¸° URLì€ ì¬ì—…ë¡œë“œ ì‹œ ìƒì„±
                ocrText: data.ocrText,
                isProcessed: !!data.ocrText, // OCR í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì²˜ë¦¬ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼
              }));
              renderFileList(); // UI ì—…ë°ì´íŠ¸

              // ì‚¬ìš©ìì—ê²Œ ì‹¤ì œ íŒŒì¼ ì¬ì—…ë¡œë“œ ìœ ë„
              setTimeout(() => {
                showStatusMessage(
                  "OCR ì²˜ë¦¬ë¥¼ ìœ„í•´ íŒŒì¼ì„ ë‹¤ì‹œ ëŒì–´ë‹¤ ë†“ê±°ë‚˜ ì„ íƒí•´ì£¼ì„¸ìš”. ê¸°ì¡´ OCR í…ìŠ¤íŠ¸ëŠ” ìë™ìœ¼ë¡œ ë§¤ì¹­ë©ë‹ˆë‹¤.",
                  "warning"
                );
              }, 1000);
            }
          } catch (e) {
            console.error("Failed to load session from local storage:", e);
            localStorage.removeItem(LOCAL_STORAGE_KEY);
          }
        }
      }

      /**
       * Tesseract.js ì›Œì»¤ì˜ ì§„í–‰ ìƒí™©ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œê±° í•¨ìˆ˜ì…ë‹ˆë‹¤.
       * ì´ í•¨ìˆ˜ëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ë©°, DOM ìš”ì†Œì— ì§ì ‘ ì ‘ê·¼í•©ë‹ˆë‹¤.
       * @param {string} status - Tesseract.js ì‘ì—… ìƒíƒœ (ì˜ˆ: 'recognizing', 'loading lang data').
       * @param {number} progress - í˜„ì¬ ì‘ì—… ì§„í–‰ë¥  (0.0 ~ 1.0).
       * @param {string} jobId - í˜„ì¬ OCR ì‘ì—…ì˜ ê³ ìœ  ID.
       * @param {number} totalImages - ì´ ì²˜ë¦¬í•  ì´ë¯¸ì§€ ìˆ˜.
       * @param {string} lang - í˜„ì¬ ì„ íƒëœ OCR ì–¸ì–´.
       */
      function updateProgressBar(status, progress, jobId, totalImages, lang) {
        if (status === "recognizing") {
          const prog = (progress * 100).toFixed(1);
          progressBar.style.width = `${prog}%`;
          progressBar.textContent = `OCR ì§„í–‰ ì¤‘: ${prog}% (${
            jobId.split("-")[1]
          }/${totalImages} ì´ë¯¸ì§€)`;
        } else if (status === "loading lang data") {
          progressBar.textContent = `ì–¸ì–´ ë°ì´í„° ë¡œë“œ ì¤‘... ${lang} (${(
            progress * 100
          ).toFixed(1)}%)`;
          progressBar.style.width = `${progress * 100}%`;
        } else if (status === "initializing api") {
          progressBar.textContent = `API ì´ˆê¸°í™” ì¤‘... (${(
            progress * 100
          ).toFixed(1)}%)`;
          progressBar.style.width = `${progress * 100}%`;
        }
      }

      /**
       * PDF ìƒì„± ë° OCR ì ìš© ë¡œì§ì…ë‹ˆë‹¤.
       */
      async function convertToPdfWithOcr() {
        if (filesToProcess.length === 0) {
          showStatusMessage(
            "ë¨¼ì € JPG ë˜ëŠ” PNG íŒŒì¼ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.",
            "warning"
          );
          return;
        }

        // ì›Œì»¤ê°€ ì´ë¯¸ ìˆë‹¤ë©´ ì¢…ë£Œí•˜ê³  ìƒˆë¡œ ì‹œì‘
        if (tesseractWorker) {
          await tesseractWorker.terminate();
        }

        // Tesseract.js ì›Œì»¤ ìƒì„±
        showStatusMessage("OCR ì›Œì»¤ë¥¼ ì´ˆê¸°í™” ì¤‘ì…ë‹ˆë‹¤...", "info");
        tesseractWorker = await Tesseract.createWorker({
          // logger í•¨ìˆ˜ë¥¼ ë‹¨ìˆœí™”í•˜ì—¬ ì§ì ‘ DOMì— ì ‘ê·¼í•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
          // ëŒ€ì‹  í•„ìš”í•œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ ì „ì—­ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ì— ì „ë‹¬í•©ë‹ˆë‹¤.
          logger: (m) => {
            updateProgressBar(
              m.status,
              m.progress,
              m.jobId,
              filesToProcess.length,
              languageSelect.value
            );
          },
        });

        try {
          // ì›Œì»¤ ë¡œë“œ ë° ì–¸ì–´ ì„¤ì •
          await tesseractWorker.load();
          await tesseractWorker.loadLanguage(languageSelect.value);
          await tesseractWorker.initialize(languageSelect.value);

          showStatusMessage("PDF ë³€í™˜ ë° OCRì„ ì‹œì‘í•©ë‹ˆë‹¤...", "info");
          convertButton.disabled = true;
          clearButton.disabled = true;

          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          for (let i = 0; i < filesToProcess.length; i++) {
            const fileObj = filesToProcess[i];

            // ë¯¸ë¦¬ë³´ê¸° URLì´ ì—†ëŠ” ê²½ìš° (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¡œë“œ í›„ ì¬ì—…ë¡œë“œ ëŒ€ê¸° ìƒíƒœ), íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ
            if (
              !fileObj.previewUrl ||
              fileObj.previewUrl.startsWith("data:image/svg+xml")
            ) {
              // svg+xmlì€ ë”ë¯¸ ì´ë¯¸ì§€.
              const reader = new FileReader();
              reader.onload = async (e) => {
                fileObj.previewUrl = e.target.result; // ì‹¤ì œ ì´ë¯¸ì§€ ë°ì´í„° ë¡œë“œ
                await processImageAndAddToPdf(
                  fileObj,
                  doc,
                  i,
                  filesToProcess.length
                );
                // ëª¨ë“  ì´ë¯¸ì§€ ì²˜ë¦¬ í›„ PDF ì €ì¥
                if (i === filesToProcess.length - 1) {
                  doc.save(`searchable_document_${Date.now()}.pdf`);
                  showStatusMessage(
                    "PDF ë³€í™˜ ë° OCR ì ìš©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!",
                    "success"
                  );
                  convertButton.disabled = false;
                  clearButton.disabled = false;
                  progressBar.style.width = "100%";
                  progressBar.textContent = "ì™„ë£Œ!";
                }
              };
              reader.readAsDataURL(fileObj.file);
            } else {
              await processImageAndAddToPdf(
                fileObj,
                doc,
                i,
                filesToProcess.length
              );
              // ëª¨ë“  ì´ë¯¸ì§€ ì²˜ë¦¬ í›„ PDF ì €ì¥
              if (i === filesToProcess.length - 1) {
                doc.save(`searchable_document_${Date.now()}.pdf`);
                showStatusMessage(
                  "PDF ë³€í™˜ ë° OCR ì ìš©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!",
                  "success"
                );
                convertButton.disabled = false;
                clearButton.disabled = false;
                progressBar.style.width = "100%";
                progressBar.textContent = "ì™„ë£Œ!";
              }
            }
          }
        } catch (error) {
          console.error("PDF ë³€í™˜ ë° OCR ì˜¤ë¥˜:", error);
          showStatusMessage(
            "PDF ë³€í™˜ ë° OCR ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
            "error"
          );
          convertButton.disabled = false;
          clearButton.disabled = false;
          progressBar.style.width = "0%";
          progressBar.textContent = "";
        } finally {
          if (tesseractWorker) {
            await tesseractWorker.terminate(); // ì‘ì—… ì™„ë£Œ í›„ ì›Œì»¤ ì¢…ë£Œ
          }
        }
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.classList.add("highlight");
      });

      dropArea.addEventListener("dragleave", () => {
        dropArea.classList.remove("highlight");
      });

      dropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        dropArea.classList.remove("highlight");
        addFiles(e.dataTransfer.files);
      });

      dropArea.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", (e) => {
        addFiles(e.target.files);
      });

      convertButton.addEventListener("click", convertToPdfWithOcr);
      clearButton.addEventListener("click", clearAllFiles);

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„¸ì…˜ ë¡œë“œ
      window.onload = () => {
        loadSession();
      };

      // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì¬ì •ë ¬ ê¸°ëŠ¥ (ê°„ë‹¨ êµ¬í˜„)
      let draggedItem = null;

      fileList.addEventListener("dragstart", (e) => {
        draggedItem = e.target.closest(".file-item");
        if (draggedItem) {
          draggedItem.classList.add("dragging");
          e.dataTransfer.setData("text/plain", draggedItem.dataset.id);
        }
      });

      fileList.addEventListener("dragend", () => {
        if (draggedItem) {
          draggedItem.classList.remove("dragging");
          draggedItem = null;
        }
      });

      fileList.addEventListener("dragover", (e) => {
        e.preventDefault();
        const targetItem = e.target.closest(".file-item");
        if (targetItem && targetItem !== draggedItem) {
          const rect = targetItem.getBoundingClientRect();
          const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
          fileList.insertBefore(
            draggedItem,
            (next && targetItem.nextSibling) || targetItem
          );
        }
      });

      fileList.addEventListener("drop", (e) => {
        e.preventDefault();
        if (draggedItem) {
          const droppedId = draggedItem.dataset.id;
          const newOrderIds = Array.from(fileList.children).map(
            (item) => item.dataset.id
          );

          // ìƒˆë¡œìš´ ìˆœì„œì— ë§ì¶° filesToProcess ë°°ì—´ ì—…ë°ì´íŠ¸
          const newFilesToProcess = [];
          newOrderIds.forEach((id) => {
            const originalFile = filesToProcess.find(
              (fileObj) => fileObj.id === id
            );
            if (originalFile) {
              newFilesToProcess.push(originalFile);
            }
          });
          filesToProcess = newFilesToProcess;
          saveSession(); // ìˆœì„œ ë³€ê²½ í›„ ì„¸ì…˜ ì €ì¥
        }
      });
    </script>
  </body>
</html>
