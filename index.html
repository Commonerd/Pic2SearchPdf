<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="JPG, PNG, HEIC, WEBP, BMP, TIFF ë“± ì´ë¯¸ì§€ë¥¼ PDFë¡œ ë³‘í•©í•˜ê³  OCR ì¸ì‹ê¹Œì§€! í•œêµ­ì–´/ì˜ì–´/ì¼ë³¸ì–´/ëŸ¬ì‹œì•„ì–´/ì¤‘êµ­ì–´/ìŠ¤í˜ì¸ì–´ ì§€ì›. ë¬´ë£Œ, ë¹ ë¥´ê³  ê°„í¸í•œ ì´ë¯¸ì§€ PDF ë³€í™˜ê¸°."
    />
    <meta
      name="keywords"
      content="ì´ë¯¸ì§€ PDF ë³€í™˜, OCR, JPG to PDF, HEIC ë³€í™˜, tesseract.js, ì´ë¯¸ì§€ í…ìŠ¤íŠ¸ ì¸ì‹, í•œêµ­ì–´ OCR, ëŸ¬ì‹œì•„ì–´ OCR, ì¤‘êµ­ì–´ OCR, ìŠ¤í˜ì¸ì–´ OCR, ì´ë¯¸ì§€ ë³‘í•©, PDF ë³€í™˜ê¸°"
    />
    <meta name="robots" content="index, follow" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <title>pic2searchpdf - ì´ë¯¸ì§€ PDF + ë‹¤êµ­ì–´ OCR ë³€í™˜ê¸°</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f2f5f9;
        color: #333;
        margin: 0;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      p {
        font-size: 1rem;
        margin-bottom: 1rem;
      }
      input[type="file"] {
        margin: 1rem 0;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 6px;
        background: white;
      }
      #fileList {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin: 1rem 0;
        width: 100%;
        max-width: 600px;
      }
      .file-item {
        background: white;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: grab;
      }
      .file-controls button {
        margin-left: 0.5rem;
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
      }
      button {
        background: #0070f3;
        color: white;
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      button:hover {
        background: #005ac1;
      }
      #output {
        margin-top: 2rem;
        max-width: 800px;
        text-align: left;
        background: #fff;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }
      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        background: #f9f9f9;
        padding: 1rem;
        border-left: 4px solid #0070f3;
      }
    </style>
  </head>
  <body>
    <h1>ì´ë¯¸ì§€ë¥¼ PDFë¡œ ë³€í™˜í•˜ê³  í…ìŠ¤íŠ¸ ì¸ì‹í•˜ê¸° (OCR)</h1>
    <p>
      JPG, PNG, HEIC, WEBP, BMP, TIFF ë“± ë‹¤ì–‘í•œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”. í•œêµ­ì–´,
      ì˜ì–´, ì¼ë³¸ì–´, ëŸ¬ì‹œì•„ì–´, ì¤‘êµ­ì–´, ìŠ¤í˜ì¸ì–´ OCR ì§€ì›.
    </p>
    <input
      type="file"
      id="fileInput"
      accept="image/*,.heic,.tiff,.bmp"
      multiple
    />
    <div id="fileList"></div>
    <button onclick="startConversion()">ğŸ“„ PDFë¡œ ë³€í™˜ + OCR ì¸ì‹</button>
    <div id="output"></div>

    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.3/dist/heic2any.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script>
      let selectedFiles = [];

      document.getElementById("fileInput").addEventListener("change", (e) => {
        selectedFiles = Array.from(e.target.files);
        renderFileList();
      });

      function renderFileList() {
        const fileList = document.getElementById("fileList");
        fileList.innerHTML = "";
        selectedFiles.forEach((file, index) => {
          const div = document.createElement("div");
          div.className = "file-item";
          div.draggable = true;
          div.dataset.index = index;
          div.innerHTML = `
          <span>${file.name}</span>
          <span class="file-controls">
            <button onclick="move(${index}, -1)">â¬†</button>
            <button onclick="move(${index}, 1)">â¬‡</button>
          </span>
        `;
          div.addEventListener("dragstart", handleDragStart);
          div.addEventListener("dragover", handleDragOver);
          div.addEventListener("drop", handleDrop);
          fileList.appendChild(div);
        });
      }

      let dragSrcIndex = null;

      function handleDragStart(e) {
        dragSrcIndex = parseInt(e.currentTarget.dataset.index);
      }

      function handleDragOver(e) {
        e.preventDefault();
      }

      function handleDrop(e) {
        const dropIndex = parseInt(e.currentTarget.dataset.index);
        const draggedFile = selectedFiles[dragSrcIndex];
        selectedFiles.splice(dragSrcIndex, 1);
        selectedFiles.splice(dropIndex, 0, draggedFile);
        renderFileList();
      }

      function move(index, direction) {
        const newIndex = index + direction;
        if (newIndex < 0 || newIndex >= selectedFiles.length) return;
        const temp = selectedFiles[index];
        selectedFiles[index] = selectedFiles[newIndex];
        selectedFiles[newIndex] = temp;
        renderFileList();
      }

      async function startConversion() {
        if (!selectedFiles.length) {
          alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");
          return;
        }

        const pdfDoc = await PDFLib.PDFDocument.create();
        const outputDiv = document.getElementById("output");
        outputDiv.innerHTML = "<p>ë³€í™˜ ì¤‘... (ì´ë¯¸ì§€ ì²˜ë¦¬ ë° OCR ë¶„ì„)</p>";

        for (const file of selectedFiles) {
          let imageFile = file;
          if (file.type === "image/heic") {
            try {
              const convBlob = await heic2any({
                blob: file,
                toType: "image/jpeg",
              });
              imageFile = new File(
                [convBlob],
                file.name.replace(/\.heic$/i, ".jpg"),
                { type: "image/jpeg" }
              );
            } catch (e) {
              alert("HEIC ë³€í™˜ ì‹¤íŒ¨: " + file.name);
              continue;
            }
          }

          const reader = new FileReader();
          const imageDataUrl = await new Promise((resolve, reject) => {
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(imageFile);
          });

          const img = new Image();
          img.src = imageDataUrl;
          await new Promise((res) => (img.onload = res));

          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          const imgBytes = await fetch(canvas.toDataURL("image/jpeg")).then(
            (res) => res.arrayBuffer()
          );
          const pdfImage = await pdfDoc.embedJpg(imgBytes);
          const page = pdfDoc.addPage([img.width, img.height]);
          page.drawImage(pdfImage, {
            x: 0,
            y: 0,
            width: img.width,
            height: img.height,
          });

          await Tesseract.recognize(img, "kor+eng+jpn+rus+chi_sim+spa", {
            logger: (m) => console.log(m),
          }).then(({ data: { text } }) => {
            const pre = document.createElement("pre");
            pre.textContent = `â–¶ ${file.name} ì¸ì‹ê²°ê³¼:\n` + text;
            outputDiv.appendChild(pre);
          });
        }

        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: "application/pdf" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "output.pdf";
        link.textContent = "â¬‡ OCR í¬í•¨ PDF ë‹¤ìš´ë¡œë“œ";
        link.style.display = "inline-block";
        link.style.marginTop = "1rem";
        link.style.fontSize = "1.1rem";
        link.style.color = "#0070f3";
        outputDiv.appendChild(link);
      }
    </script>
  </body>
</html>
