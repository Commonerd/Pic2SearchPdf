<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      ì´ë¯¸ì§€ PDF ë³€í™˜ê¸° | HEIC, JPG, PNG OCR í…ìŠ¤íŠ¸ ì¸ì‹ & ë“œë˜ê·¸ ìˆœì„œ ì¡°ì •
    </title>
    <meta
      name="description"
      content="HEIC, JPG, PNG ë“± ë‹¤ì–‘í•œ ì´ë¯¸ì§€ íŒŒì¼ì„ PDFë¡œ ë³€í™˜í•˜ê³ , OCR ê¸°ëŠ¥ì„ í†µí•´ í…ìŠ¤íŠ¸ë¥¼ ì¸ì‹í•©ë‹ˆë‹¤. ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ì´ë¯¸ì§€ ìˆœì„œë¥¼ ì‰½ê²Œ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    />
    <meta
      name="keywords"
      content="ì´ë¯¸ì§€ PDF ë³€í™˜, ì‚¬ì§„ PDF, HEIC PDF, OCR, í…ìŠ¤íŠ¸ ì¸ì‹, ì´ë¯¸ì§€ ìˆœì„œ ë³€ê²½, ë¬´ë£Œ PDF ë³€í™˜ê¸°, JPG PDF, PNG PDF, WEBP PDF, TIFF PDF, BMP PDF"
    />
    <meta name="author" content="Your Name or Company Name" />
    <meta property="og:title" content="ì´ë¯¸ì§€ PDF & OCR ë³€í™˜ê¸°" />
    <meta
      property="og:description"
      content="HEIC, JPG, PNG ë“± ë‹¤ì–‘í•œ ì´ë¯¸ì§€ íŒŒì¼ì„ PDFë¡œ ë³€í™˜í•˜ê³ , OCR ê¸°ëŠ¥ì„ í†µí•´ í…ìŠ¤íŠ¸ë¥¼ ì¸ì‹í•©ë‹ˆë‹¤. ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ì´ë¯¸ì§€ ìˆœì„œë¥¼ ì‰½ê²Œ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://www.yourwebsite.com/image-to-pdf-ocr"
    />
    <meta
      property="og:image"
      content="https://www.yourwebsite.com/images/og-image.jpg"
    />
    <link rel="canonical" href="https://www.yourwebsite.com/image-to-pdf-ocr" />
    <meta name="geo.region" content="KR" />
    <meta name="geo.placename" content="Seoul" />
    <meta name="geo.position" content="37.5665;126.9780" />
    <meta name="ICBM" content="37.5665, 126.9780" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ë³€ìˆ˜ ì„ ì–¸ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ ìš©ì´ì„± ë° ì¼ê´€ì„± í™•ë³´ */
      :root {
        --primary-color: #007bff; /* íŒŒë€ìƒ‰ ê³„ì—´ */
        --primary-dark-color: #0056b3;
        --secondary-color: #6c757d; /* íšŒìƒ‰ ê³„ì—´ */
        --background-color: #f8f9fa;
        --card-background-color: #ffffff;
        --border-color: #e0e0e0;
        --text-color: #343a40;
        --heading-color: #212529;
        --shadow-light: rgba(0, 0, 0, 0.08);
        --shadow-medium: rgba(0, 0, 0, 0.12);
      }

      body {
        font-family: "Noto Sans KR", sans-serif; /* í•œêµ­ì–´ í°íŠ¸ ì ìš© */
        background: var(--background-color);
        color: var(--text-color);
        margin: 0;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        line-height: 1.6;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
        width: 100%;
        max-width: 700px;
      }

      h1 {
        font-size: 2.5rem; /* ë” í¬ê³  ëˆˆì— ë„ê²Œ */
        color: var(--heading-color);
        margin-bottom: 1rem;
        font-weight: 700; /* ë” ë‘ê»ê²Œ */
      }

      p {
        font-size: 1.1rem; /* ì„¤ëª… í…ìŠ¤íŠ¸ í¬ê¸° ì¦ê°€ */
        margin-bottom: 1.5rem;
        max-width: 700px;
        text-align: center;
        color: var(--secondary-color);
      }

      main {
        width: 100%;
        max-width: 700px; /* ì»¨í…ì¸  ì˜ì—­ ìµœëŒ€ ë„ˆë¹„ ì¡°ì • */
        background: var(--card-background-color);
        padding: 2.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 20px var(--shadow-light); /* ê·¸ë¦¼ì ê°•í™” */
        box-sizing: border-box;
      }

      #dropZone {
        width: 100%;
        height: 180px; /* ë†’ì´ ì¦ê°€ */
        border: 3px dashed var(--border-color); /* í…Œë‘ë¦¬ ë‘ê»˜ ì¦ê°€ */
        border-radius: 10px;
        display: flex;
        flex-direction: column; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì„¸ë¡œë¡œ ì •ë ¬ */
        justify-content: center;
        align-items: center;
        cursor: pointer;
        margin: 1.5rem 0;
        background: #fdfdff; /* ë°°ê²½ìƒ‰ ë°ê²Œ */
        user-select: none;
        transition: all 0.3s ease; /* í˜¸ë²„ íš¨ê³¼ ì¶”ê°€ */
        color: var(--secondary-color);
        font-size: 1.1rem;
      }

      #dropZone:hover {
        border-color: var(--primary-color);
        background: #f0f7ff;
        color: var(--primary-dark-color);
      }

      #dropZone.dragging {
        background: #e0eaff; /* ë“œë˜ê·¸ ì¤‘ ë°°ê²½ìƒ‰ ë³€ê²½ */
        border-color: var(--primary-dark-color);
        box-shadow: 0 0 15px rgba(0, 123, 255, 0.2);
      }

      .drop-icon {
        font-size: 3rem; /* ì•„ì´ì½˜ í¬ê¸° */
        margin-bottom: 0.8rem;
        color: var(--primary-color);
      }

      input[type="file"] {
        display: none;
      }

      #fileList {
        display: flex;
        flex-direction: column;
        gap: 0.7rem; /* ê°„ê²© ì¦ê°€ */
        margin-top: 1.5rem;
        width: 100%;
        list-style: none;
        padding: 0;
      }

      .file-item {
        background: var(--card-background-color);
        padding: 0.7rem 1.2rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: grab;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px var(--shadow-light);
      }

      .file-item:hover {
        background: #f0f0f0;
      }

      .file-item:active {
        cursor: grabbing;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow-medium);
      }

      .file-name {
        flex-grow: 1;
        user-select: text;
        font-size: 0.95rem;
        color: var(--text-color);
      }

      .remove-file {
        background: none;
        border: none;
        color: #dc3545; /* ë¹¨ê°„ìƒ‰ X ë²„íŠ¼ */
        font-size: 1.2rem;
        cursor: pointer;
        margin-left: 1rem;
        transition: color 0.2s ease;
      }

      .remove-file:hover {
        color: #c82333;
      }

      .ocr-options {
        margin: 2rem 0;
        background: #fdfdfd;
        padding: 1.5rem;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        box-shadow: 0 2px 10px var(--shadow-light);
      }

      .ocr-options label {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        font-size: 1rem;
        color: var(--heading-color);
        cursor: pointer;
        user-select: none;
      }

      .ocr-options input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2); /* ì²´í¬ë°•ìŠ¤ í¬ê¸° í‚¤ìš°ê¸° */
        accent-color: var(--primary-color); /* ì²´í¬ë°•ìŠ¤ ìƒ‰ìƒ ë³€ê²½ */
        cursor: pointer;
      }

      .ocr-languages {
        margin-top: 1rem;
        display: grid; /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€ê²½ */
        grid-template-columns: repeat(
          auto-fit,
          minmax(120px, 1fr)
        ); /* ë°˜ì‘í˜• ê·¸ë¦¬ë“œ */
        gap: 15px; /* ê°„ê²© ë„“í˜ */
        padding-left: 25px; /* OCR ìˆ˜í–‰í•˜ê¸° ì²´í¬ë°•ìŠ¤ì™€ ì •ë ¬ */
      }

      .ocr-languages label {
        margin-bottom: 0; /* ê°œë³„ ë¼ë²¨ì˜ í•˜ë‹¨ ë§ˆì§„ ì œê±° */
      }

      button.convert-btn {
        background: var(--primary-color);
        color: white;
        padding: 1rem 2rem; /* ë²„íŠ¼ íŒ¨ë”© ì¦ê°€ */
        font-size: 1.2rem; /* ë²„íŠ¼ í°íŠ¸ í¬ê¸° ì¦ê°€ */
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.2s ease;
        margin-top: 1.5rem;
        width: 100%; /* ë„ˆë¹„ 100%ë¡œ ì„¤ì • */
        font-weight: 700;
        letter-spacing: 0.5px;
      }

      button.convert-btn:hover {
        background: var(--primary-dark-color);
        transform: translateY(-2px); /* í˜¸ë²„ ì‹œ ì•½ê°„ ìœ„ë¡œ */
        box-shadow: 0 5px 15px rgba(0, 123, 255, 0.25);
      }

      button.convert-btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
      }

      .progress-container {
        width: 100%;
        background: var(--border-color);
        border-radius: 8px;
        overflow: hidden;
        margin: 2rem 0;
        height: 25px; /* ì§„í–‰ë°” ë†’ì´ ì¦ê°€ */
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        height: 100%;
        width: 0;
        background: var(--primary-color);
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.9rem;
      }

      #output {
        margin-top: 2rem;
        width: 100%;
        background: var(--card-background-color);
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 20px var(--shadow-light);
        text-align: left;
        display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        word-break: break-word; /* ê¸´ ë‹¨ì–´ ì¤„ ë°”ê¿ˆ ì²˜ë¦¬ */
      }

      #output h3 {
        color: var(--heading-color);
        margin-top: 0;
        margin-bottom: 1rem;
      }

      #output pre {
        background: #f0f4f7;
        padding: 1.2rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        max-height: 400px; /* OCR ê²°ê³¼ ì˜ì—­ ë†’ì´ ì œí•œ */
        overflow-y: auto; /* ìŠ¤í¬ë¡¤ë°” ì¶”ê°€ */
        white-space: pre-wrap;
        word-wrap: break-word;
        font-size: 0.9rem;
        color: var(--text-color);
      }

      .download-link {
        display: inline-block;
        background: #28a745; /* ë…¹ìƒ‰ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        margin-bottom: 1.5rem;
        transition: background 0.3s ease;
      }

      .download-link:hover {
        background: #218838;
      }

      /* ë°˜ì‘í˜• ë””ìì¸ */
      @media (max-width: 768px) {
        body {
          padding: 1rem;
        }
        h1 {
          font-size: 2rem;
        }
        p {
          font-size: 1rem;
        }
        main {
          padding: 1.5rem;
        }
        #dropZone {
          height: 150px;
          font-size: 1rem;
        }
        .drop-icon {
          font-size: 2.5rem;
        }
        button.convert-btn {
          font-size: 1.1rem;
          padding: 0.9rem 1.8rem;
        }
        .ocr-languages {
          grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>ğŸ“¸ ì´ë¯¸ì§€ë¥¼ PDFë¡œ ë³€í™˜í•˜ê³  OCR í…ìŠ¤íŠ¸ ì¸ì‹í•˜ê¸° ğŸ“„</h1>
      <p>
        JPG, PNG, WEBP, BMP, TIFF ë“± ë‹¤ì–‘í•œ ì´ë¯¸ì§€ íŒŒì¼ì„ PDF ë¬¸ì„œë¡œ ë³€í™˜í•˜ê³ ,
        ì´ë¯¸ì§€ ì† í…ìŠ¤íŠ¸ë¥¼ OCR ê¸°ìˆ ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë˜ëŠ” íŒŒì¼
        ì„ íƒìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³ , ë§ˆìš°ìŠ¤ë¡œ ìˆœì„œë¥¼ ì†ì‰½ê²Œ ì¡°ì •í•˜ì„¸ìš”.
      </p>
    </header>

    <main>
      <div id="dropZone">
        <span class="drop-icon">â¬†ï¸</span>
        ì—¬ê¸°ì— ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”
      </div>
      <input
        type="file"
        id="fileInput"
        accept="image/*,.heic,.heif,.tiff,.bmp"
        multiple
      />

      <ul id="fileList"></ul>

      <div class="ocr-options">
        <label>
          <input type="checkbox" id="doOCR" checked />
          <span style="font-weight: bold">OCR ìˆ˜í–‰í•˜ê¸°</span> (ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸
          ì¶”ì¶œ)
        </label>
        <div class="ocr-languages">
          <label><input type="checkbox" value="kor" checked /> í•œêµ­ì–´</label>
          <label><input type="checkbox" value="eng" checked /> ì˜ì–´</label>
          <label><input type="checkbox" value="jpn" /> ì¼ë³¸ì–´</label>
          <label><input type="checkbox" value="rus" /> ëŸ¬ì‹œì•„ì–´</label>
          <label><input type="checkbox" value="chi_sim" /> ì¤‘êµ­ì–´ (ê°„ì²´)</label>
          <label><input type="checkbox" value="spa" /> ìŠ¤í˜ì¸ì–´</label>
          <label><input type="checkbox" value="deu" /> ë…ì¼ì–´</label>
          <label><input type="checkbox" value="fra" /> í”„ë‘ìŠ¤ì–´</label>
        </div>
      </div>

      <button class="convert-btn" onclick="startConversion()">
        <span id="convertButtonText">ğŸš€ PDFë¡œ ë³€í™˜ ë° OCR ì¸ì‹ ì‹œì‘</span>
      </button>

      <div class="progress-container" style="display: none">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <div id="output"></div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.3/dist/heic2any.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script>
      const dropZone = document.getElementById("dropZone");
      const fileInput = document.getElementById("fileInput");
      const fileList = document.getElementById("fileList");
      const outputDiv = document.getElementById("output");
      const progressContainer = document.querySelector(".progress-container");
      const progressBar = document.getElementById("progressBar");
      const doOCRCheckbox = document.getElementById("doOCR");
      const convertBtn = document.querySelector(".convert-btn");
      const convertButtonText = document.getElementById("convertButtonText");

      let selectedFiles = [];

      // ë“œë˜ê·¸ì•¤ë“œë¡­ ë° í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
      dropZone.addEventListener("click", () => fileInput.click());

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragging");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("dragging");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragging");
        const files = Array.from(e.dataTransfer.files);
        addFiles(files);
      });

      fileInput.addEventListener("change", (e) => {
        const files = Array.from(e.target.files);
        addFiles(files);
        fileInput.value = ""; // ì¤‘ë³µ ì„ íƒ ë°©ì§€
      });

      function addFiles(files) {
        // ì¤‘ë³µ íŒŒì¼ëª… ì²´í¬ ë° ì¶”ê°€
        files.forEach((file) => {
          if (
            !selectedFiles.some(
              (f) => f.name === file.name && f.size === file.size
            )
          ) {
            selectedFiles.push(file);
          }
        });
        renderFileList();
        outputDiv.style.display = "none"; // íŒŒì¼ ì¶”ê°€ ì‹œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
        outputDiv.innerHTML = "";
        progressContainer.style.display = "none";
        progressBar.style.width = "0%";
        progressBar.textContent = ""; // ì§„í–‰ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        updateConvertButtonState();
      }

      function renderFileList() {
        fileList.innerHTML = "";
        selectedFiles.forEach((file, index) => {
          const li = document.createElement("li");
          li.className = "file-item";
          li.setAttribute("data-index", index);
          li.innerHTML = `
            <span class="file-name">${file.name}</span>
            <button class="remove-file" data-index="${index}">&times;</button>
          `;
          fileList.appendChild(li);
        });

        // íŒŒì¼ ì œê±° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll(".remove-file").forEach((button) => {
          button.addEventListener("click", (e) => {
            const indexToRemove = parseInt(e.target.dataset.index);
            selectedFiles.splice(indexToRemove, 1); // ë°°ì—´ì—ì„œ íŒŒì¼ ì œê±°
            renderFileList(); // íŒŒì¼ ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§
            outputDiv.style.display = "none"; // ê²°ê³¼ ì˜ì—­ ìˆ¨ê¸°ê¸°
            outputDiv.innerHTML = "";
            progressContainer.style.display = "none";
            progressBar.style.width = "0%";
            progressBar.textContent = "";
            updateConvertButtonState();
          });
        });
      }

      // SortableJSë¥¼ ì´ìš©í•´ ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œ ìˆœì„œ ì¡°ì • ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
      new Sortable(fileList, {
        animation: 150,
        onEnd: (evt) => {
          const oldIndex = evt.oldIndex;
          const newIndex = evt.newIndex;
          if (oldIndex === newIndex) return;
          // selectedFiles ë°°ì—´ë„ ìˆœì„œ ë³€ê²½ ë°˜ì˜
          const movedItem = selectedFiles.splice(oldIndex, 1)[0];
          selectedFiles.splice(newIndex, 0, movedItem);
          // renderFileList(); // Sortablejsê°€ DOMì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ë¯€ë¡œ ë‹¤ì‹œ ê·¸ë¦´ í•„ìš” ì—†ìŒ
        },
      });

      // ë³€í™˜ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
      function updateConvertButtonState() {
        if (selectedFiles.length > 0) {
          convertBtn.disabled = false;
        } else {
          convertBtn.disabled = true;
        }
      }

      async function startConversion() {
        if (selectedFiles.length === 0) {
          alert("ğŸ’¡ ìµœì†Œ í•œ ê°œ ì´ìƒì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
          return;
        }

        outputDiv.style.display = "none"; // ì´ì „ ê²°ê³¼ ìˆ¨ê¸°ê¸°
        outputDiv.innerHTML = "";
        progressContainer.style.display = "block";
        progressBar.style.width = "0%";
        progressBar.textContent = "ë³€í™˜ ì¤€ë¹„ ì¤‘...";
        convertBtn.disabled = true; // ë³€í™˜ ì¤‘ ë²„íŠ¼ ë¹„í™œì„±í™”
        convertButtonText.textContent = "ë³€í™˜ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”";

        const doOCR = doOCRCheckbox.checked;
        const languageCheckboxes = document.querySelectorAll(
          ".ocr-languages input[type=checkbox]:checked"
        );
        const languages =
          Array.from(languageCheckboxes)
            .map((el) => el.value)
            .join("+") || "kor"; // ì„ íƒëœ ì–¸ì–´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ìœ¼ë¡œ í•œêµ­ì–´ ì„ íƒ

        // pdf-libë¡œ PDF ë§Œë“¤ê¸°
        const pdfDoc = await PDFLib.PDFDocument.create();

        let fullText = "";
        for (let i = 0; i < selectedFiles.length; i++) {
          const file = selectedFiles[i];
          let imageDataUrl;

          progressBar.style.width = `${Math.round(
            (i / selectedFiles.length) * 100
          )}%`;
          progressBar.textContent = `ì´ë¯¸ì§€ ë³€í™˜ ì¤‘ (${i + 1}/${
            selectedFiles.length
          })...`;

          try {
            imageDataUrl = await convertFileToDataURL(file);
          } catch (err) {
            alert(`âš ï¸ ì´ë¯¸ì§€ ë³€í™˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${file.name}. ìŠ¤í‚µí•©ë‹ˆë‹¤.`);
            console.error(err);
            continue;
          }

          const img = new Image();
          img.src = imageDataUrl;

          await new Promise((resolve) => (img.onload = resolve));

          let pdfImage;
          try {
            if (
              file.type.startsWith("image/png") ||
              imageDataUrl.startsWith("data:image/png")
            ) {
              pdfImage = await pdfDoc.embedPng(imageDataUrl);
            } else {
              pdfImage = await pdfDoc.embedJpg(imageDataUrl);
            }
          } catch (e) {
            console.warn(
              `ì´ë¯¸ì§€ ì„ë² ë”© ì‹¤íŒ¨ (PNG/JPG): ${file.name}. JPEGë¡œ ì¬ì‹œë„í•©ë‹ˆë‹¤.`,
              e
            );
            // PNGê°€ ì•„ë‹ ê²½ìš° JPGë¡œ ë‹¤ì‹œ ì‹œë„ (ì•ˆì „ì„±)
            try {
              pdfImage = await pdfDoc.embedJpg(imageDataUrl);
            } catch (e2) {
              alert(
                `âš ï¸ PDFì— ì´ë¯¸ì§€ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${file.name}. ì´ ì´ë¯¸ì§€ëŠ” ì œì™¸ë©ë‹ˆë‹¤.`
              );
              console.error("ìµœì¢… ì´ë¯¸ì§€ ì„ë² ë”© ì‹¤íŒ¨:", e2);
              continue;
            }
          }

          // ì´ë¯¸ì§€ ë¹„ìœ¨ì— ë§ì¶° í˜ì´ì§€ ìƒì„±
          const { width, height } = pdfImage.scale(1); // ì›ë³¸ ë¹„ìœ¨ ìœ ì§€
          const page = pdfDoc.addPage([width, height]);
          page.drawImage(pdfImage, {
            x: 0,
            y: 0,
            width: width,
            height: height,
          });

          if (doOCR) {
            progressBar.textContent = `OCR ì¸ì‹ ì¤‘ (${i + 1}/${
              selectedFiles.length
            })...`;
            try {
              const {
                data: { text },
              } = await Tesseract.recognize(imageDataUrl, languages, {
                logger: (m) => {
                  if (m.status === "recognizing text") {
                    progressBar.textContent = `OCR ì¸ì‹ ì¤‘ (${i + 1}/${
                      selectedFiles.length
                    }) ${Math.round(m.progress * 100)}%...`;
                  }
                },
              });
              fullText += `----- [${file.name}] -----\n` + text.trim() + "\n\n";
            } catch (e) {
              fullText += `----- [${file.name}] -----\nğŸš¨ OCR ì‹¤íŒ¨\n\n`;
              console.error(`OCR ì‹¤íŒ¨: ${file.name}`, e);
            }
          }
        }

        progressBar.style.width = `100%`;
        progressBar.textContent = "ë³€í™˜ ì™„ë£Œ!";

        // PDF ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
        const pdfBytes = await pdfDoc.save();
        const pdfBlob = new Blob([pdfBytes], { type: "application/pdf" });
        const pdfUrl = URL.createObjectURL(pdfBlob);

        const downloadLink = document.createElement("a");
        downloadLink.href = pdfUrl;
        downloadLink.download = "converted_images_with_ocr.pdf"; // íŒŒì¼ëª… êµ¬ì²´í™”
        downloadLink.textContent = "ğŸ“¥ ë³€í™˜ëœ PDF ë‹¤ìš´ë¡œë“œ";
        downloadLink.className = "download-link"; // ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ì ìš©

        outputDiv.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
        outputDiv.appendChild(downloadLink);
        outputDiv.style.display = "block"; // ê²°ê³¼ ì˜ì—­ í‘œì‹œ

        if (doOCR && fullText.trim() !== "") {
          const ocrTextTitle = document.createElement("h3");
          ocrTextTitle.textContent = "ğŸ“‹ OCR ì¸ì‹ ê²°ê³¼:";

          const ocrTextArea = document.createElement("pre");
          ocrTextArea.textContent = fullText;

          outputDiv.appendChild(ocrTextTitle);
          outputDiv.appendChild(ocrTextArea);
        } else if (doOCR && fullText.trim() === "") {
          const ocrTextTitle = document.createElement("h3");
          ocrTextTitle.textContent = "ğŸ“‹ OCR ì¸ì‹ ê²°ê³¼:";
          const noOcrText = document.createElement("p");
          noOcrText.textContent = "OCR ê²°ê³¼ê°€ ì—†ê±°ë‚˜ ì¶”ì¶œëœ í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
          outputDiv.appendChild(ocrTextTitle);
          outputDiv.appendChild(noOcrText);
        }

        // ë³€í™˜ ì™„ë£Œ í›„ ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
        convertBtn.disabled = false;
        convertButtonText.textContent = "ğŸš€ PDFë¡œ ë³€í™˜ ë° OCR ì¸ì‹ ì‹œì‘";
        selectedFiles = []; // ë³€í™˜ ì™„ë£Œ í›„ ëª©ë¡ ì´ˆê¸°í™” (ì„ íƒ ì‚¬í•­)
        renderFileList();
      }

      async function convertFileToDataURL(file) {
        if (
          file.type === "image/heic" ||
          file.name.toLowerCase().endsWith(".heic") ||
          file.name.toLowerCase().endsWith(".heif")
        ) {
          // HEIC/HEIF ë³€í™˜
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = async function () {
              const blob = new Blob([reader.result], { type: file.type }); // ì›ë˜ íŒŒì¼ íƒ€ì… ìœ ì§€ ì‹œë„
              try {
                const conversionResult = await heic2any({
                  blob,
                  toType: "image/jpeg", // HEICëŠ” JPEGë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì 
                  quality: 0.9,
                });
                const convertedBlob =
                  conversionResult instanceof Blob
                    ? conversionResult
                    : conversionResult[0]; // ë°°ì—´ë¡œ ë°˜í™˜ë  ìˆ˜ ìˆìŒ
                const convReader = new FileReader();
                convReader.onload = () => resolve(convReader.result);
                convReader.onerror = () =>
                  reject("HEIC ë³€í™˜ëœ ì´ë¯¸ì§€ ì½ê¸° ì‹¤íŒ¨");
                convReader.readAsDataURL(convertedBlob);
              } catch (e) {
                reject("HEIC ë³€í™˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + e.message);
              }
            };
            reader.onerror = () => reject("HEIC íŒŒì¼ ì½ê¸° ì‹¤íŒ¨");
            reader.readAsArrayBuffer(file);
          });
        } else {
          // ì¼ë°˜ ì´ë¯¸ì§€
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = () => reject("ì´ë¯¸ì§€ ì½ê¸° ì‹¤íŒ¨");
            reader.readAsDataURL(file);
          });
        }
      }

      // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateConvertButtonState();
    </script>
  </body>
</html>
